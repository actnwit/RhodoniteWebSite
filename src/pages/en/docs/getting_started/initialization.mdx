---
title: Initialization
description: About the initialization of Rhodonite
---

import DocLayout from '../../../../components/docs_layouts/DocLayout.astro';

<DocLayout>

## Initialization

Initialization of Rhodonite is simple.

In the Rn.System.init method, specify the process approach and the Canvas to draw to. Don't forget to specify `await`.

Depending on which process approach is chosen, the internal processing of WebGL differs.
For the latest Rhodonite we recommend DataTexture.

```javascript
await Rn.System.init({
  approach: Rn.ProcessApproach.DataTexture,
  canvas: document.getElementById('world')
};
```

### List of Process Approaches

| Type | Characteristics |
|:-----------|------------|
| Uniform | Works with WebGL2. Uses Uniform variables for passing shader parameters, suitable for troubleshooting as you can check the parameters passed to Uniform variables in e.g. specter.js. |
| DataTexture | Works with WebGL2. Uses floating point textures for passing shader parameters. Normally recommended to use this instead of Uniform. |
| WebGPU | Works with WebGPU |

## Rn.Config

This configuration is optional.
[Rn.Config](https://actnwit.github.io/RhodoniteTS/api/variables/default.Config.html) is an object used to configure Rhodonite.
If you want to change the default value, set a value to `Rn.Config.xxx`.
This value should be set before calling the `Rn.System.init` method.

```typescript
Rn.Config.maxLightNumber = 8;
Rn.Config.cgApiDebugConsoleOutput = true;

await Rn.System.init({
  approach: Rn.ProcessApproach.DataTexture,
  canvas: document.getElementById('world')
};
```

The following is a list of properties and their meanings.

| Property Name | Meaning |
|:-----------|------------|
| boneDataType | The data type used in skeletal animation processing. Specify one of Rn.BoneDataType.Mat43x1, Rn.BoneDataType.Vec4x2, Rn.BoneDataType.Vec4x2Old, Rn.BoneDataType.Vec4x1. Usually the default Rn.BoneDataType.Mat43x1 is fine. |
| cacheWebGpuRenderBundles | Whether to cache render bundles in WebGPU. Usually true is fine. |
| cgApiDebugConsoleOutput | Whether to output WebGL/WebGPU debug information to the console |
| eventTargetDom | The DOM element that the mouse event targets. The default is the canvas element to draw to. |
| isMobile | Whether it is a mobile device |
| isUboEnabled | Whether to enable UBO. Recommended to be false. The default is false. |
| scenegraphComponentCountPerBufferView | The number of SceneGraph components to allocate memory contiguously when allocating memory. This is a trade-off between performance and memory usage. The default is 10. |
| cameraComponentCountPerBufferView | The number of Camera components to allocate memory contiguously when allocating memory. This is a trade-off between performance and memory usage. The default is 1. |
| lightComponentCountPerBufferView | The number of Light components to allocate memory contiguously when allocating memory. This is a trade-off between performance and memory usage. The default is 1. |
| materialCountPerBufferView | The number of Material components to allocate memory contiguously when allocating memory. This is a trade-off between performance and memory usage. The default is 3. |
| maxLightNumber | The maximum number of lights that Rhodonite can handle |
| maxSkeletalBoneNumberForUniformMode | The maximum number of bones for each skeletal that can be handled simultaneously in Uniform mode |
| maxBoneNumberForMemoryBoostMode | The maximum number of bones for each skeletal that can be handled simultaneously in MemoryBoost mode |
| multiViewForWebVR | Whether to enable the WebVR multi-view extension |
| physicsTimeIntervalScale | The scale value of the time interval of the physics calculation |
| bufferSizeDivisionRatiosForGPUInstanceDataUsage | The ratio of the buffer size for GPU instance data usage. Normally, this does not need to be changed. |

## MemoryBoost Mode

MemoryBoost Mode is a mode that uses a lot of memory to improve performance.
By allocating a lot of components in memory contiguously, performance is improved.
In this mode, there is a limit on the number of bones that can be used for skeletal animation.
The limit is set by `maxBoneNumberForMemoryBoostMode`.

```typescript
Rn.setUpAsMemoryBoostMode();
Rn.Config.maxBoneNumberForMemoryBoostMode = 1000;

await Rn.System.init({
  approach: Rn.ProcessApproach.DataTexture,
  canvas: document.getElementById('world')
};
```

The `setUpAsMemoryBoostMode` method simply changes several Config values at once.

```typescript
export function setUpAsMemoryBoostMode() {
  Config.bufferSizeDivisionRatiosForGPUInstanceDataUsage = [1 / 4, 1 / 4, 1 / 4, 1 / 4];
  Config.skeletalComponentCountPerBufferView = 100;
  Config.scenegraphComponentCountPerBufferView = 1000;
  Config.materialCountPerBufferView = 30;
}
```

In MemoryBoost mode, a lot of components are allocated in memory contiguously to improve performance.
This mode has a limit on the number of bones that can be used for skeletal animation.
The limit is set by `maxBoneNumberForMemoryBoostMode`.

```typescript
Rn.setUpAsMemoryBoostMode();
Rn.Config.maxBoneNumberForMemoryBoostMode = 1000;

await Rn.System.init({
  approach: Rn.ProcessApproach.DataTexture,
  canvas: document.getElementById('world')
};
```

## Logger

This configuration is optional.
`Rn.Logger.loglevel` can be set to the following values.

| Value | Meaning |
|:-----------|------------|
| `Rn.LogLevel.Error` | Outputs errors |
| `Rn.LogLevel.Warn` | Outputs errors and warnings |
| `Rn.LogLevel.Debug` | Outputs errors, warnings, and debug information |
| `Rn.LogLevel.Info` | Outputs errors, warnings, debug information, and detailed information |

```typescript
Rn.Logger.loglevel = Rn.LogLevel.Info;
```

Setting this will output the desired level of log to the browser's developer console.

Especially, by setting the following, detailed shader error information can be output when the shader build fails.

```typescript
Rn.Config.cgApiDebugConsoleOutput = true;
Rn.Logger.loglevel = Rn.LogLevel.Info;
```

## Summary

Rhodonite initialization is now complete.

<iframe src="https://codesandbox.io/embed/hg2z2f?view=preview&module=%2Fsrc%2Findex.ts&expanddevtools=1"
     style="width:100%; height: 500px; border:0; border-radius: 4px; overflow:hidden;"
     title="Rhodonite_example (Initialization)"
     allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
     sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
   ></iframe>

</DocLayout>
